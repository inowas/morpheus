version: "3.8"
services:
  frontend:
    image: inowas/morpheus-frontend:${FRONTEND_VERSION}
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.${COMPOSE_PROJECT_NAME}-frontend-http.entrypoints=web"
      - "traefik.http.routers.${COMPOSE_PROJECT_NAME}-frontend-http.rule=Host(`${FRONTEND_HOST}`)"
      - "traefik.http.routers.${COMPOSE_PROJECT_NAME}-frontend-http.middlewares=redirect-to-https"
      - "traefik.http.middlewares.redirect-to-https.redirectscheme.scheme=https"
      - "traefik.http.middlewares.redirect-to-https.redirectscheme.permanent=true"
      - "traefik.http.routers.${COMPOSE_PROJECT_NAME}-frontend.entrypoints=websecure"
      - "traefik.http.routers.${COMPOSE_PROJECT_NAME}-frontend.rule=Host(`${FRONTEND_HOST}`)"
      - "traefik.http.routers.${COMPOSE_PROJECT_NAME}-frontend.tls=true"
      - "traefik.http.routers.${COMPOSE_PROJECT_NAME}-frontend.tls.certresolver=${TRAEFIK_CERT_RESOLVER}"
      - "traefik.http.routers.${COMPOSE_PROJECT_NAME}-frontend.service=${COMPOSE_PROJECT_NAME}-frontend"
      - "traefik.http.services.${COMPOSE_PROJECT_NAME}-frontend.loadbalancer.server.port=8080"
      - "traefik.docker.network=${TRAEFIK_NETWORK}"
    networks:
      - traefik
    restart: always
    read_only: true
    tmpfs:
      - /var/run:mode=777,size=100m
      - /var/cache/nginx:mode=777,size=100m
#  backend:
#    image: inowas/morpheus-backend:${BACKEND_VERSION}
#    depends_on:
#      - mongo
#      - postgres
#    environment:
#      DYNACONF_SECRET_KEY: ${SECRET_KEY}
#      DYNACONF_POSTGRES_USER: ${POSTGRES_USER}
#      DYNACONF_POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
#      DYNACONF_POSTGRES_DB: ${POSTGRES_DB}
#      DYNACONF_POSTGRES_HOST: ${POSTGRES_HOST}
#      DYNACONF_POSTGRES_PORT: ${POSTGRES_PORT}
#      DYNACONF_MONGO_INITDB_ROOT_USERNAME: ${MONGO_INITDB_ROOT_USERNAME}
#      DYNACONF_MONGO_INITDB_ROOT_PASSWORD: ${MONGO_INITDB_ROOT_PASSWORD}
#      DYNACONF_MONGO_HOST: ${MONGO_HOST}
#    labels:
#      - "traefik.enable=true"
#      - "traefik.http.routers.${COMPOSE_PROJECT_NAME}-backend-http.entrypoints=web"
#      - "traefik.http.routers.${COMPOSE_PROJECT_NAME}-backend-http.rule=Host(`${BACKEND_HOST}`)"
#      - "traefik.http.routers.${COMPOSE_PROJECT_NAME}-backend-http.middlewares=redirect-to-https"
#      - "traefik.http.middlewares.redirect-to-https.redirectscheme.scheme=https"
#      - "traefik.http.middlewares.redirect-to-https.redirectscheme.permanent=true"
#      - "traefik.http.routers.${COMPOSE_PROJECT_NAME}-backend.entrypoints=websecure"
#      - "traefik.http.routers.${COMPOSE_PROJECT_NAME}-backend.rule=Host(`${BACKEND_HOST}`)"
#      - "traefik.http.routers.${COMPOSE_PROJECT_NAME}-backend.tls=true"
#      - "traefik.http.routers.${COMPOSE_PROJECT_NAME}-backend.tls.certresolver=${TRAEFIK_CERT_RESOLVER}"
#      - "traefik.http.routers.${COMPOSE_PROJECT_NAME}-backend.service=${COMPOSE_PROJECT_NAME}-backend"
#      - "traefik.http.services.${COMPOSE_PROJECT_NAME}-backend.loadbalancer.server.port=8000"
#      - "traefik.docker.network=${TRAEFIK_NETWORK}"
#    networks:
#      - traefik
#    restart: always
#    user: flask
#    read_only: true
#  postgres:
#    image: postgres:13.12
#    environment:
#      POSTGRES_USER: ${POSTGRES_USER}
#      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
#      POSTGRES_DB: ${POSTGRES_DB}
#    volumes:
#      - ./db/postgres:/var/lib/postgresql/data
#    restart: always
#  mongo:
#    image: mongo:5.0
#    environment:
#      MONGO_INITDB_ROOT_USERNAME: ${MONGO_INITDB_ROOT_USERNAME}
#      MONGO_INITDB_ROOT_PASSWORD: ${MONGO_INITDB_ROOT_PASSWORD}
#    volumes:
#      - ./db/mongo:/data/db
#    restart: always

networks:
  traefik:
    name: ${TRAEFIK_NETWORK}
    external: true
